name: Update LeetCode Stats

on:
    schedule:
        - cron: '0 0 * * 0'  # Runs every Sunday at midnight UTC
    workflow_dispatch:  # Allows manual triggering of the workflow
    push:
        branches:
            - main
        paths:
            - '.leetcode/update_stats.py'

jobs:
    update-stats:
        runs-on: ubuntu-latest
        
        steps:
            - name: üì• Checkout Repository
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0
            
            - name: üêç Setup Python
              uses: actions/setup-python@v5
              with:
                  python-version: '3.11'
                  cache: 'pip'
            
            - name: üì¶ Install Dependencies
              run: |
                  python -m pip install --upgrade pip
                  pip install requests
            
            - name: üîÑ Update LeetCode Statistics
              run: |
                  python .leetcode/update_stats.py
            
            - name: üìù Check for Changes
              id: check_changes
              run: |
                  git diff --quiet README.md || echo "changed=true" >> $GITHUB_OUTPUT
            
            - name: üíæ Commit and Push Changes
              if: steps.check_changes.outputs.changed == 'true'
              run: |
                  git config --local user.email "github-actions[bot]@users.noreply.github.com"
                  git config --local user.name "github-actions[bot]"
                  git add README.md
                  git commit -m "ü§ñ Auto-update LeetCode statistics [skip ci]"
                  git push
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            
            - name: ‚úÖ Success Message
              if: steps.check_changes.outputs.changed == 'true'
              run: echo "‚úÖ LeetCode statistics updated successfully!"
            
            - name: ‚ÑπÔ∏è No Changes
              if: steps.check_changes.outputs.changed != 'true'
              run: echo "‚ÑπÔ∏è No changes detected in statistics"
